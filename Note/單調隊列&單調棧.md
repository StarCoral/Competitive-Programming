# 單調隊列&單調棧


## 單調(monotone)

在數學中有序集合之間的函數，  
如果它們保持給定的次序(遞增/遞減)，  
我們稱之為**單調**

+ 單調遞增(非遞減)： 只要x<y，則f(x)<=f(y)
+ 單調遞減(非遞增)： 只要x<y，則f(x)>=f(y) 

## 單調隊列Monotone Queue

### 定義

單調隊列是一種資料結構，  
而其隊列內中的元素滿足單調的特性，  
能夠動態地維護固定長度array中的極值

### 應用

1. 維護區間極值
2. 優化DP轉移

### 原理

單調隊列其實是一種雙向隊列(deque)，  
在加入一個元素時，透過一定操作維護隊列的單調性。  
+ 加入隊尾(push_back)：
  為了維護隊列元素的單調性，對於加入的元素，我們可能要刪除一些隊尾的元素=>  
  1. 插入時，要pop出所有比要插入元素大的隊尾元素，
  2. 直到隊尾元素不再比其大後，再插入
  3. 插入元素時要計入插入元素再原序列中的位置(用於pop出隊首)
+ 彈出隊首(pop_front) 
  對於插入的元素，要檢查它和隊首元素的位置之差(是否過期)  
  當這個差值大於隊列的固定的長度:隊首長度已經在區間外=>  
  pop出

### Example

> Question
> 維護一個Array = [1，3，2，6，4，9，0，11]，固定長度3的遞增區間。

1. 先向隊列中插入1：deque = 1(1)。
2. 由於長度未達到3，直接再插入3：deque = 1(1) 3(2)。
3. 插入2時，發現隊尾存在比2大的3，彈出3：deque = 1(1) 2(3)。
4. 隊列長已滿足3，再插入6，發現序列頭元素已經在區間外，彈出1：deque = 2(3) 6(4)。
5. .....

```
for(int i = 1 ; i <= n ; i++){
    while(dq.back().val >= a[i]) dq.pop_back();
    dq.push_back(node(a[i],i));
    if(i-dq.front().pos >= len) dq.pop_front();
}
```

## 單調棧Monotone Stack

### 定義

單調棧是一種先進後出資料結構，  
而其棧內中的元素滿足單調的特性，  
能夠動態地維護固定長度array中的極值，  
只從一端進、出元素

### 應用

比當前元素更大的下一個元素
比當前元素更大的前一個元素
比當前元素更小的下一個元素
比當前元素更小的前一個元素


### Example

> Question
> 維護一個Array = [1，3，2，6，4]

```
遞減棧(大->小)
1.  1      (stack為空，push(1))
2.  3      (3>1，pop(1)，push(3))
3.  3,2    (2<3，push(2))
4.  6      (6>2>3，pop(2)，pop(3)，push(6)
5.  6,4    (4<6，push(4)
```


https://zh.wikipedia.org/wiki/%E5%8D%95%E8%B0%83%E5%87%BD%E6%95%B0
https://www.itread01.com/content/1538639929.html
https://ksmeow.moe/monotonic_queue/
https://kknews.cc/zh-tw/tech/plpvjne.html
